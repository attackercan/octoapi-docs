[[{"l":"Документация ScanFactory","p":["Платформа ScanFactory проводит автоматизированное сканирование внешней сетевой инфраструктуры и вебсайтов Заказчика на предмет выявления уязвимостей методом «чёрного» и «серого» ящика с помощью 16 сканеров безопасности."]}],[{"i":"1---быстрый-старт","l":"1 - Быстрый старт","p":["С помощью данной статьи вы сможете оценить функционал и возможности решения. Чтобы протестировать решение в вашей компании, запишитесь на пилот: support@scanfactory.io"]},{"l":"1. Создайте и запустите новый проект","p":["Перейдя во вкладку Проекты нажмите на кнопку Создать проект. Заполните появившуюся форму. Укажите имя проекта, цели сканирования: хотя бы один домен, вайлдкард, IP или подсеть (Рис. 1.2).","Рис. 1.2","Нажмите на кнопку Создать, если хотите провести более тонкую настройку проекта перед запуском сканирований, либо Cоздать и сканировать, если хотите оставить остальные параметры по умолчанию и начать скан немедленно.","Некоторые из возможностей более тонкой настройки проекта:","создание черных списков для http-ссылок, доменов и IP;","указание временного интервала для проведения сканирований (например, только 1:00-5:00 утра);","настройка и создание шаблонов сканирований отдельно для каждого инструмента.","Развернутые инструкции по настройке можно найти в разделе Техническая Документация.","Перед стартом сканирования необходимо добавить наши IP-адреса 158.160.8.240/28 в whitelist на ваших WAF/IDS."]},{"l":"2. Настройте проект","p":["Выберите созданный проект из списка. Перед вами появится страница настроек (Рис. 2.1)","Рис. 2.1","Домены: домены (например, yandex.ru) и вайлдкарды (например, *.yandex.ru). Вайлдкард *.yandex.ru означает, что сканированию подлежит домен yandex.ru и все его поддомены.","IP и подсети: адреса IPv4 и подсети (например, 11.22.33.44/24).","Blacklist скоупа: черный список, где могут быть указаны домены, вайлдкарды, регулярные выражения (для доменов), IPv4 адреса и подсети и регулярные выражения для HTTP ссылок. Примеры:","re:xyz.u\\d+.domain.com","domain.com","*.sub.domain.com","https?://domain.com/foo/\\w+","Исключения из blacklist-a: Здесь можно указать исключения из черного списка. Могут быть указаны домены, вайлдкарды, регулярные выражения (для доменов), IPv4 адреса и подсети и регулярные выражения для HTTP ссылок.","Переключатель \"Ручное подтверждение новых активов\" означает, ни один домен не будет просканирован пока его IP-адреса не будут занесены вами в IP и подсети. Используйте её, чтобы сканирование не шло по ресурсам, которые расположены на IP-адресах сторонних организаций.","Ручное подтверждение новых активов \"Включено\" (по умолчанию) - добавляйте IP адреса интересующих Вас доменов вручную, иначе они не будут просканированы. Ручное подтверждение новых активов \"Выключено\" - IP адреса доменов проекта будут заноситься в скоуп автоматически.","Вы можете провести тонкую конфигурацию запускаемых сканеров. Подробнее об этом - в разделе Технический обзор ScanFactory"]},{"l":"3. Дашборд","p":["В данном разделе отображается сводная статистика работы Системы.","Рис. 3.1"]},{"l":"4. Активы","p":["Активы - страница, которая отображает текущее состояние инфраструктуры Заказчика.","После окончания сканирования на странице Активов будут отображены найденные IP, порты и домены.","Рис. 4.1"]},{"l":"5. Уязвимости","p":["Выгрузить события в формате JSON.","Выполнять поиск и фильтрацию уязвимостей по заданным параметрам;","Дата обнаружения","Компонент, который обнаружил уязвимость","Нажав на название уязвимости возможно перейти на карточку уязвимости, и получить подробную информацию о ней. В карточке уязвимости указаны:","Название","Описание","Просматривать все обнаруженные уязвимости;","Просмотреть подробную информацию об уязвимости в карточке уязвимости;","Рис. 5.1","Рис. 5.2","Статус","Управлять статусом уязвимостей;","Уровень важности","Функционал раздела “Уязвимости” позволяет:","Шаги по воспроизведению"]},{"l":"6. Подключение телеграм-бота","p":["Начните диалог с телеграм-ботом: @scanfactory_reporter_bot","Подключите бота к вашему Личному Кабинету с помощью команды:/connect https://yx-client.scanfactory.io/api/ token TOKEN","Рабочий токен вы можете получить, связавшись с технической поддержкой."]}],[{"i":"2---технический-обзор-scanfactory","l":"2 - Технический обзор ScanFactory"},{"l":"Вступление","p":["На этой странице подробно описаны используемые инструменты и возможные параметры запуска."]},{"l":"Этапы сканирования","p":["--max-rtt-timeout 600ms- максимальное время получения ответа от порта--min-rtt-timeout 10ms- минимальное время получения ответа от порта--initial-rtt-timeout 300ms- первоначальное время получения ответа (нмап сам меняет это значение, в рамках min/max опций выше)--host-timeout 110m- максимальное время сканирования IP = 1 час 50 минут--max-retries 3- количество повторных попыток на сканирование порта--max-scan-delay 100ms- максимальная задержка между отправкой повторных пакетов","1","2","3","altdns запустит брутфорс поддоменов на 3 уровень *.company.ru(т.к. в настройках был указан wildcard 3 уровня), а также *.dev.company.ru(т.к. домен 4 уровня был найден с помощью amass). Для этого создаётся 2 списка потенциальных доменов, и осуществляется резолв доменов с помощью инструмента massdns, публичных резолверов Yandex и Google, со скоростью 1000 запросов в секунду.","amass и subfinder- Пассивный поиск поддоменов по открытым источникам altdns- Рекурсивный брутфорс поддоменов по словарю (словарь по умолчанию - 1000 слов) sdto- Проверка перехватов поддомена. Opensource инструмент собственной разработки","amass нашёл домен 2 домена: www.company.ru(3 уровня) и домен sub.dev.company.ru(4 уровня). Оба домена добавлены в БД, и отображаются на вкладке Активы","crawler- обход веб-приложения с помощью headless Chrome краулера собственной разработки, а также сохранение скриншотов главной страницы crawlergo- обход страниц веб-приложений dirsearch- поиск скрытых файлов и папок на веб-сервере Результат работы – набор GET/POST запросов, которые передаются на следующий этап","№","webscan- сканер OWASP Top 10 уязвимостей. Инструмент работает в режиме proxy nuclei- opensource сканер веб-приложений с набором публичных и приватных шаблонов. ffuf- поиск скрытых GET/POST параметров путём поиска аномалий в ответах сервера. На каждый имеющийся HTTP-запрос в базе данных инструмент отправляет более 1000 запросов (вида http://client.ru/api/?DEBUG=1, http://client.ru/api/ADMIN?=1, и другие). Мы рекомендуем включать этот инструмент, только если у вас в скоупе 1-5 веб-приложений, и НЕ включать его, если веб-приложений больше","Все имеющиеся ссылки имеют одинаковый паттерн: http://client.ru/products/book-[\\d]/","Все обнаруженные запросы проходят через двухуровневую систему отсева «неинтересных» запросов: Уровень 1. Отсев ссылок с похожим форматом Пример. Во время краулинга интернет-магазина были найдены следующие ссылки:","Выбранные шаблоны инструментов будут запущены на все IP из диапазона 11.22.33.44/23, а также на все IP, в которые резолвятся обнаруженные домены из Этапа 1.","Выбранные шаблоны инструментов будут запущены на все открытые порты:","Для примера рассмотрим сканирование Компании со следующими входными данными: Домены, принадлежащие компании: *.company.ru IP, принадлежащие компании: 11.22.33.44/23","Доступен следующий набор инструментов:","Доступен следующий набор инструментов: nmap- поиск открытых портов, а также определение версий сервисов infrascan- поиск известных CVE. База данных CVE является самой большой в мире, содержит более 65000 проверок, и обновляется каждый день patator- брутфорс паролей к сетевым сервисам по дефолтным словарям","Как только в базу данных будет добавлено 50 (значение по умолчанию) ссылок с одинаковым паттерном, далее ссылки с таким же паттерном сохраняться не будут. В нашем примере будут сохранены только запросы к книгам с 1 по 50.","Краулинг веб-сайтов; поиск скрытых файлов и папок; поиск уязвимостей","Мы используем следующие настройки для nmap:","На каждый найденный поддомен запускается проверка перехвата поддоменов с помощью инструмента sdto","На финальном этапе запускаются следующие шаблоны инструментов:","Описание этапа","Определение открытых портов и сервисов; поиск известных CVE; брутфорс аутентификации на сетевых сервисах (FTP, SSH, Telnet, и др)","Перечень доменов и IP, принадлежащих Заказчику","Платформа проводит сканирование внешнего периметра в 3 логических этапа:","При сканировании больших подсетей (более, чем /23) рекомендуем включать дополнительную настройку «Предварительный ping IP». В этом случае на каждый сервер отправляется команда nmap -sn IP, и на основе результата сервер будет отмечен как «Активный» или «Не активный». Далее, шаблоны инструментов будут запущены только на IP, определённые как «Активные».","При старте проекта создаётся 2 шаблона nmap: на топ-1000 портов; и на все 65535 портов. Также вы можете создать свой шаблон с нужными опциями nmap На каждый открытый порт определяется версия запущенного сервиса, и запускается поиск известных уязвимостей к этой версии сервиса с помощью сервиса Vulners","Пример работы nmap обнаруживает открытый порт 22, и опредляет версию запущенного сервиса как OpenSSH 7.9. Сервер помечается как \"активный\", и информацию по этому сервису теперь можно увидеть на вкладке Активы Сервис Vulners сообщает, что версия OpenSSH устарела и имеет перечень уязвимостей, поэтому создаёт новую запись об этой Уязвимости infrascan запускает анализ каждого IP patator запускает брутфорс авторизаций на каждый открытый порт","Пример работы:","Результат работы","С этими настройками 1000 портов на 1 сервере сканируются за 25 секунд. Таким образом, подсеть размера /23 (512 IP) на топ 1000 портов мы можем просканировать за 4,5 часа (имея 1 запущенную копию nmap)","Сбор активов (OSINT)","Сканирование веб-приложений","Сканирование веб-приложений методом «серого ящика» Авторизация в веб-приложениях работает путём добавления авторизационных HTTP-заголовок к краулерам Для этого создайте новый шаблоны crawler и crawlergo с параметрами: extra_headers: {Cookie: a=b}(подставить сюда хэдеры, по которому приложение авторизует пользователя)","Сканирование веб-приложений проходит в 3 этапа: сбор информации о веб-приложении, отсев «неинтересных» запросов, и поиск уязвимостей","Сканирование сетевых сервисов","Так как и все наши заказчики, и мы находимся в России - а значит, ответы о том, закрыт порт или нет, мы будем получать быстро, то мы используем разумные настройки, которые выполняют скан даже быстрее, чем nmap timing option -Т4, и при этом выдают достоверный результат","Так как указанные хэдеры будут добавляться ко всем запросам краулера, то нужно создавать отдельный проект под каждое веб-приложение, для которого настраивается авторизация","Уровень 2. Отсев страниц с похожим содержимым ScanFactory использует собственную технологию, основанную на SimHash, которая анализирует контент каждой веб-страницы перед сохранением в базу данных. В случае, если большое количество страниц имеет одинаковую HTML-структуру (например, страницы блога, или карточки товаров), такие страницы не сохраняются"]}],[{"i":"3---список-используемых-сканеров","l":"3 - Список используемых сканеров","p":["altnds","amass","brute","crawler","crawlergo","dirsearch","ffuf","grep","infrascan","nmap","nuclei","patator","phuip-fpizdam","sdto","subfinder","waybackurls","webscan","wpscan","x8","В этом разделе перечислены сканеры, используемые в ScanFactory, а также какие данные инструменты получают на вход, и что производят на выходе.","вход: HTTP-запрос","вход: HTTP-запрос (ссылка)","вход: IP","вход: IP-адрес","вход: вайлдкард (*.domain.ru)","вход: домен","вход: домен/IP","вход: порт","вход: порт / веб форма","выход: HTTP-запросы","выход: HTTP-запросы, домены","выход: алерт","выход: открытые порты","выход: список найденных доменных имён","выход: транзакции","выход: уязвимости","выход: уязвимость","предназначение: автоматизированный перебор паролей к сетевым сервисам","предназначение: автоматизированный поиск уязвимостей","предназначение: активный брутфорс поддоменов","предназначение: брутфорсер паролей для протоколов ftp, ftps, mssql, postgres, radmin2, rdp, redis, amqp, smb, snmp, ssh, vnc, telnet; брутфорсер веб форм","предназначение: пассивный поиск поддоменов","предназначение: поиск CVE","предназначение: поиск OWASP Top 10 уязвимостей","предназначение: поиск доменов и HTTP-ссылок на веб-страницах","предназначение: поиск открытых портов и определение запущенных сервисов","предназначение: поиск скрытых параметров на веб-сайтах","предназначение: поиск скрытых файлов и папок","предназначение: поиск ссылок на этот домен в Wayback Machine","предназначение: поиск уязвимостей Wordpress","предназначение: проверка на уязвимость CVE-2019-11043","предназначение: проверка перехвата поддомена","предназначение: рекурсивный обход сайтов, сбор HTTP-запросов и доменов","предназначение: сканер скрытых параметров в ссылках"]}],[{"i":"4---документация-по-api","l":"4 - Документация по API","p":["Здесь описаны несколько полезных API-эндпоинтов для получения интересующих вас данных"]},{"l":"Получить API токен"},{"l":"Получить список живых хостов","p":["$gt-ports.last_seen","$lt-ports.last_seen","1","1 or 0","address","alive","all","Description","domain","domain string","found_by","hidden","https://yx-test.sf-cloud.ru/api/hosts/?alive=1","include_dead_ports","int","IP string","limit","Parameter","pending","ports.port_number","project_id","skip","sort","string","string(datetime)","True/1 or string/int","Value","Включить в ответ порты, помеченные мертвыми, по умолчанию 0","Если указано skip и limit игнорируется, запрашивает все хосты","Или выполнить следующий код","Каждый из них опционален","Количество хостов, которое будет показано на одной странице","Количество хостов, которое будет пропущено для пагинации","Необходимо авторизоваться, зайти по вашей ссылке scanfactory /api/hosts/?alive=1:","Поиск живых или мертвых хостов","Поиск ожидающих хостов (True или 1), поиск активных (любое дргугое значение)","Поиск скрытых хостов","Поиск хостов с указанным ID проекта","Поиск хостов с указанным IP. Формат: 127.0.0.1","Поиск хостов с указанными доменными именами. Формат: 'google.com'","Поиск хостов с указанными портами","Поиск хостов, найденных указанным сканером","Поиск хостов, у которых хотя бы один порт был замечен до указанного времени. Формат ' 2022-06-14T17:27:25.024141'","Поиск хостов, у которых хотя бы один порт был замечен после указанного времени. Формат ' 2022-06-14T17:27:25.024141'","Сортировка хостов. Варианты: host, last_seen, mdate, alert_count. По умолчанию host. Каждое значение может быть с перфиксом -, что означает сортировку в обратном порядке: -last_seen"]},{"l":"Получить уязвимости за неделю","p":["$gt-last_seen","1 or 0","active","Description","https://yx-test.sf-cloud.ru/api/alerts/?active=1","Parameter","project_id","sort","string","string(unix_timestamp)","string(uuid)","Value","Или выполнить следующий код","Необходимо авторизоваться, зайти по вашей ссылке scanfactory /api/alerts/?active=1:","Поиск активных уязвимостей","Поиск уязвимостей, найденных, после указанной даты","Поиск язвимостей по указанному проекту","Сортировка хостов. Варианты: host, last_seen, mdate, alert_count. По умолчанию host. Каждое значение может быть с перфиксом -, что означает сортировку в обратном порядке: -last_seen"]},{"i":"добавлениеудаление-хостов-в-проекте","l":"Добавление/удаление хостов в проекте","p":["Чтобы добавить или удалить хосты в проекте, необходимо выполнить PATCH запрос на https://yx-test.sf-cloud.ru/api/projects/project_UUID"]},{"l":"Body запроса","p":["Что вы отправите в запросе, то и будет находиться в настройках проекта, т.е. если в настройках было 3 домена, вы отправите 1 домен в запросе, значит только что отправленный один домен и будет в настройках","Пустой отправленный список доменов или IP удалит из скоупа все домены или IP"]},{"l":"Код"}],[{"i":"5---интеграции","l":"5 - Интеграции","p":["Здесь вы можете найти документацию по интеграции с внешними сервисами"]},{"l":"Список","p":["5 - Интеграции"]}],[{"l":"Интеграция с Defect Dojo","p":["Scanfactory позволяет экспортировать отчеты по уязвимостям из нашей системы в ваш Defect Dojo"]},{"l":"Установка и запуск","p":["Для работы необходим Python 3.10+ и менеджер пакетов pip","Выполните команды:","При неудаче проверьте наличие и версии python3 и pip/pip3 и попробуйте снова","Добавьте ваши логины-пароли от ScanFactory и DefectDojo в файл nessus_importer.env Переместите env-файл в /root/.env, или в любое другое место","Создайте crontab на ежедневный запуск скрипта: 0 8 * * * python3 /root/nessus_importer.py --log-path=/path/to/.log --env-path=/root/.env","Проверьте работу скрипта, запустив его в ручном режиме","Дополнительная информация"]},{"l":"Возможные проблемы","p":["Проблемы при первом запуске - взгляните на логи","Проблемы с дедупликацией отчетов в Defect Dojo Возможные варианты решения Первый Второй"]}]]